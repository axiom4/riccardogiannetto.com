<div
  class="lightbox"
  [class.is-open]="previewImage()"
  (transitionend)="onLightboxTransitionEnd($event)"
>
  <span class="count"> {{ getIndex() }}/{{ totalImageCount() }} </span>
  @if (previewImage()) {
    <button
      type="button"
      (click)="onclosePreview()"
      class="close-btn"
      title="Close"
    >
      <span
        class="icon-lightbox-carousel"
        onKeyPress=""
        onKeyDown=""
        onKeyUp=""
      >
        Close
      </span>
    </button>
  }
  @if (controls()) {
    <button
      type="button"
      class="btn-lightbox-carousel btn-prev"
      title="Previous"
      (click)="prev()"
    >
      <span class="icon-lightbox-carousel">Prev</span>
    </button>
  }
  @if (controls()) {
    <button
      type="button"
      class="btn-lightbox-carousel btn-next"
      title="Next"
      (click)="next()"
    >
      <span class="icon-lightbox-carousel">Next</span>
    </button>
  }
  <div class="lightbox-img" [class.is-open]="previewImage()">
    <div class="lightbox-frame">
      @if (isLoading()) {
        <div class="loading-msg">
          <svg
            width="100"
            height="100"
            viewBox="0 0 64 64"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow
                  dx="2"
                  dy="2"
                  stdDeviation="1"
                  flood-color="rgba(0,0,0,0.5)"
                />
              </filter>
            </defs>
            <g
              filter="url(#shadow)"
              stroke="#fff"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M8 16 H 18 L 22 10 H 42 L 46 16 H 56 C 58.2 16 60 17.8 60 20 V 48 C 60 50.2 58.2 52 56 52 H 8 C 5.8 52 4 50.2 4 48 V 20 C 4 17.8 5.8 16 8 16 Z"
                fill="none"
              />
              <circle cx="32" cy="34" r="12" fill="none" />
              <circle cx="32" cy="34" r="9" fill="#fff" stroke="none" />
            </g>
            <text
              x="32"
              y="62"
              font-family="Arial, sans-serif"
              font-size="9"
              text-anchor="middle"
              fill="#fff"
              stroke="none"
              filter="url(#shadow)"
              letter-spacing="1"
            >
              LOADING...
            </text>
          </svg>
        </div>
      }
      @if (previousLightboxImg(); as prevImg) {
        <img
          class="lightbox-image previous"
          [ngClass]="{
            'image-anim-a': imageAnimA(),
            'image-anim-b': !imageAnimA(),
          }"
          alt="{{ prevImg.title }}"
          src="{{ prevImg.url }}/width/{{ getLightboxRenderWidth() }}"
          width="{{ getGalleryImageWidth(prevImg.width, prevImg.height) }}"
          height="{{ getGalleryImageHeight(prevImg.width, prevImg.height) }}"
          aria-hidden="true"
        />
      }
      @if (currentLightboxImg(); as img) {
        <img
          #galleryPreviewImg
          class="lightbox-image current"
          [ngClass]="{
            'image-anim-a': imageAnimA(),
            'image-anim-b': !imageAnimA(),
            'page-next': pageFlipDirection() === 'next',
            'page-prev': pageFlipDirection() === 'prev',
          }"
          alt="{{ img.title }}"
          src="{{ img.url }}/width/{{ getLightboxRenderWidth() }}"
          width="{{ getGalleryImageWidth(img.width, img.height) }}"
          height="{{ getGalleryImageHeight(img.width, img.height) }}"
          fetchpriority="high"
          (load)="onImageLoad()"
          (error)="onImageLoad()"
        />
      }
    </div>
  </div>
</div>
